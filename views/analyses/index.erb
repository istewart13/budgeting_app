<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Merchant</th>
      <th>Tag</th>
      <th>Value</th>
      <th>Date</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>

    <% @transactions.each do |transaction| %>
    <tr>
      <td><%= transaction.id %></td>
      <td><%= transaction.merchant.name %></td>
      <td><%= transaction.tag.name %></td>
      <td><%= "%.2f" % transaction.value %></td>
      <td><%= transaction.transaction_date %></td>
      <td><%= transaction.description %></td>
    </tr>
    <% end %>

  </tbody>
</table>
<br>

<p>Total transaction value: <b><%= @analysis.total_expenditure.round(2) %></b>
<b>View as</b>
<a href="/json">JSON</a>
<b>Download</b>
<a href="/json/download">JSON</a>
<p>

<b>Filter transactions by merchant:</b>
<form action="/merchant" method="post">
  <label for="merchant_id">Total by merchant:</label>
  <select name="merchant_id">
    
    <% merchant_array = [] %>
    <% @transactions.each do |transaction| %>

    <% if !merchant_array.include?(transaction.merchant_id) %>
    <option value="<%= transaction.merchant_id %>">
      <%= transaction.merchant.name %></option>
      <% end %>
      <% merchant_array << transaction.merchant_id %>
      <% end %>
    </select>

  <input type='submit' value="Search by merchant">
</form>

<br>
<b>Filter transactions by tag:</b>

<form action="/analyses" method="post">
  <label for="tag_id">Total by tag:</label>
  <select name="tag_id">

    <% tag_array = [] %>
    <% @transactions.each do |transaction| %>

    <% if !tag_array.include?(transaction.tag_id) %>
    <option value="<%= transaction.tag_id %>">
      <%= transaction.tag.name %></option>
      <% end %>
      <% tag_array << transaction.tag_id %>

      <% end %>
    </select>

  <input type='submit' value="Search by tag">
</form>

<br>
<b>Filter transactions by value:</b>
<form action="/value" method="post">
  <label for="value">Filter by value:</label>
  <select name="value">
    <option value="1">£0 - £50</option>
    <option value="2">>£50 - £100</option>
    <option value="3">>£100 - £500</option>
    <option value="4">>£500 - £1000</option>
    <option value="5">> £1000</option>
  </select>

  <input type='submit' value="Search by value">
</form>

<br>
<b>Filter transactions between dates:</b>
<form action="/date" method="post">
  <label for="transaction_date">Filter by date:</label>
  <input type="date" name="transaction_date1" min="2010-01-01">
  <input type="date" name="transaction_date2" min="2010-01-01">

  <input type='submit' value="Search by date">
</form>

<br>
<b>Filter transactions by keyword:</b>
<form action="/description" method="post">
  <label for="description">Filter by keyword:</label>
  <input type="text" name="description">

  <input type='submit' value="Search by description">
</form>